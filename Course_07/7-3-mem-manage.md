# 메모리 관리

- c++는 실행할 때부터 메모리의 특정 위치를 사용
- 메모리를 효율적으로 관리하기 위해서 메모리를 여러 영역으로 나눔
  - 코드 메모리 : 프로그램 코드를 저장
  - 정적 메모리 : `전역 객체`와 `정적 객체`를 저장
  - 스택 메모리 : `지역 변수`와 `함수의 매개변수` 저장
  - 힙 메모리 : 런타움 중에 생성되는 객체 저장

## 스택 메모리

- 제한
  - 컴파일 시점에 객체의 이름을 정의해야 함
    - 이름이 없는 객체는 스택에 저장 불가
  - 컴파일 시점에 객체의 크기를 정의해야 함
    - 시스템이 객체의 크기를 모르면 스택 메모리에 영역을 할당할 수 없음
    - 단일 객체의 경우, 자료형을 기반으로 크기를 확인
    - 객체 리스트(배열)의 경우, 컴파일 때에 반드시 요소의 수를 정의함
  - 예시) : 메모리에 저장할 모든 객체는 컴파일 시점에 확실하게 이름과 크기가 정의되어 있어야 함
    ```c++
    int main()
    {
      int size;
      cin >> size;
      double array[size]; // 컴파일 에러
      ...
      return 0;
    }
    ```

## 힙 메모리

- 프로그램 컴파일 시점에 객체의 크기를 정확히 모른다면, `런타임 시점`에 메모리에 객체를 만들어야 함!
- `힙 메모리`는 런타임 시점에 객체를 저장할 때 사용
  - 여유 메모리(free memory) 또는 동적 메모리(dynamic memory)라고 함
- 포인터는 `스택 메모리`에, 포인트 되는 객체는 `힙 메모리`에 있음!
- **new와 delete 연산자**
  - 힙 메모리에 객체를 할당하고 제거하는 연산자
  - 객체 할당 : `new type`
  - 객체 제거 : `delete ptr`
  - 배열 할당 : `new type[size]`
  - 배열 제거 : `delete[] ptr`

- 허상 포인터(dangling pointer)
  - delete를 하면 해당 포인터는 허상 포인터가 됨
  - 허상 포인터는 new 연산자를 적용하기 전까지 사용할 수 없음

- 힙 메모리와 관련된 문제
  - 메모리 할당 없이 제거
  - 제거 없이 메모리 할당하기(=메모리 누수)
    - new 키워드로 힙 메모리 위에 영역을 잡은 뒤, delete 키워드로 제거하지 않았을 때 발생
    - 누수가 발생한 메모리 위치는 사용할 수 없으며, 메모리가 부족한 경우 시스템에 큰 문제가 발생함
  - 허상 포인터
    - 이미 delete 키워드로 제거한 객체의 포인터를 다시 사용하려고 하는 경우 발생

- **2차원 배열과 메모리**
  - 스택 메모리만 사용
    - 일반적인 방식(전체 크기를 알아야 함)
  - `스택 메모리`와 `힙 메모리`를 모두 사용하여 2차원 배열 만들기
    - 컴파일 시점에 행 크기는 알지만, 열 크기를 모르는 경우
    - 스택에 행을 나타내는 배열 포인터를 만든 뒤, 힙 메모리에 행을 올리는 방식!
      ```c++
      int* arr[4]; // 4개의 int형 포인터를 담은 배열 (스택)
      cin >> colNums;
      for (int i = 0; i < 4; i++)
      {
        arr[i] = new int [colNums]; // 각 행의 '열'을 힙 메모리에 생성함 (힙)
      }
      ```
  - `힙 메모리`만 사용
    - 컴파일 단계에서 행 차원과 열 차원의 크기를 모두 알 수 없는 경우
    - 이중 포인터 사용
      ```c++
      cin >> rowNums;
      cin >> colNums;
      int** arr = new int* [rowNums]; // 각 행에 대한 포인터 배열 할당 받음 (힙)
      for (int i = 0; i < n + 1; i++)
      {
        arr[i] = new int [colNums]; // 각 행에 대한 열 생성(힙)
      }
      ```
    - **래기드(ragged) 배열**
      - 각각의 행의 요소 수가 서로 다른 2차원 배열
      - 예시) 파스칼의 삼각형
        - (x+y)^n 을 전개했을 때의 계수들을 정리한 것